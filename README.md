# AI Grant Screener for Non-Profits

An intelligent, fully automated grant screening pipeline that uses **Gemini AI + SerpAPI** to research, classify, and export grant opportunities directly to Google Sheets - in real time, with color-coded rows and clickable source links.

Designed to save nonprofits hours of manual research by automatically screening dozens of grant foundations and telling you which ones are worth pursuing.

---

## How It Works

```
MySQL/CRM Database
       â†“  (fetch grant opportunities)
SerpAPI Priority Search
  â†’ ProPublica (990 data)
  â†’ Granted AI
  â†’ Candid
  â†’ CauseIQ
       â†“  (pre-fetched evidence)
Gemini 3 Flash (+ Google Search grounding)
  â†’ 3-step chain-of-thought reasoning
  â†’ RED / YELLOW / GREEN classification
       â†“
Google Sheets (live, color-coded, clickable links)
```

---

## Features

- **Priority source search** via SerpAPI - always checks ProPublica, Granted, Candid, and CauseIQ first
- **Gemini AI reasoning** with Google Search grounding for additional evidence
- **3-step chain-of-thought** classification (check red flags â†’ count green flags â†’ classify)
- **Live Google Sheets export** - rows written one by one as each grant is processed
- **Color-coded rows** - ðŸŸ¢ Green / ðŸŸ¡ Yellow / ðŸ”´ Red
- **Clickable hyperlinks** in Sources column (up to 5 per grant)
- **Skip logic** - skips grants already in the sheet (safe to re-run)
- **CLI Setup Wizard** - describe your org in plain English, AI builds your screening prompt
- **Update tool** - change specific rules without re-running the full wizard
- **Fully configurable** - no hardcoded org details anywhere in the code

---

## Classification Logic

Every grant is classified into one of three categories. **All three classes and what they mean are fully defined by you** - the setup wizard generates the rules from your plain-English answers.

### What Each Class Means

| Class | Color | What it means | Action |
|---|---|---|---|
| ðŸŸ¢ **GREEN** | Light green row | Strong alignment - mission, geography, size, and audience all match | **Apply** |
| ðŸŸ¡ **YELLOW** | Light yellow row | Partial fit or needs follow-up - promising but something is unclear or requires outreach | **Review manually** |
| ðŸ”´ **RED** | Light red row | Hard disqualifier found - wrong geography, closed, wrong focus, inactive, etc. | **Skip** |

> **YELLOW is not a rejection.** It's a flag for human review - often because the foundation is invite-only but mission-aligned (worth reaching out), or because there's simply not enough public data to be confident.

---

### How the AI Reasons (3 Steps)

The AI follows a strict chain-of-thought for every grant - it never jumps straight to a conclusion:

**Step 1 - Check Red Flags**
Checks each of your disqualifiers one by one (e.g. "only funds universities", "no NJ grantees", "inactive 3+ years"). If any hard red flag is found â†’ immediate **RED**.

> Special case - *Invitation Only (R1b)*: If the foundation is invite-only but has at least 1 green flag, it's classified **YELLOW** instead of RED - since it's worth reaching out.

**Step 2 - Count Green Flags**
If no hard red flags, evaluates each of your positive signals (e.g. "STEM mission", "past grants in target city", "equity focus") and counts YES answers.

**Step 3 - Classify**
Applies your exact classification rules:
- ðŸŸ¢ **GREEN** if green flag count â‰¥ your threshold (default: 4)
- ðŸŸ¡ **YELLOW** if below threshold, or matched a user-defined borderline condition
- ðŸ”´ **RED** if any hard flag hit

> All three steps and their exact rules come from your `screener_config.json` - generated by the setup wizard from your plain-English descriptions. You can change them anytime with `python update_config.py --classification`.

---

## Project Structure

```
.
â”œâ”€â”€ setup_wizard.py      # One-time setup: describe your org â†’ AI builds screening config
â”œâ”€â”€ update_config.py     # Update specific config sections without re-running wizard
â”œâ”€â”€ main.py              # Run the screening pipeline
â”œâ”€â”€ clear_sheet.py       # Clear all rows + formatting from Google Sheet
â”œâ”€â”€ count_backlog.py     # Check how many grants are in the DB backlog
â”œâ”€â”€ fix_columns.py       # One-time utility: fix sheet column layout after schema changes
â”œâ”€â”€ .env.example         # Template - copy to .env and fill in your values
â”œâ”€â”€ requirements.txt
â””â”€â”€ src/
    â”œâ”€â”€ gemini_client.py    # Core: SerpAPI + Gemini screening logic + prompt builder
    â”œâ”€â”€ serp_searcher.py    # SerpAPI multi-source search (ProPublica, Granted, Candid, CauseIQ)
    â”œâ”€â”€ sheets_writer.py    # Google Sheets writer (live rows, colors, rich text hyperlinks)
    â”œâ”€â”€ db_connector.py     # MySQL/CRM connector
    â””â”€â”€ models.py           # Grant / ScreeningResult data models
```

---

## Prerequisites

- Python 3.10+
- A MySQL-compatible CRM or database with grant opportunity records
- API keys for: Gemini, SerpAPI
- A Google Cloud project with Sheets API enabled (for export)

---

## Setup

### 1. Clone & Install

```bash
git clone https://github.com/Tans37/AI-Agent-Grant-Screener-for-Non-Profits.git
cd AI-Agent-Grant-Screener-for-Non-Profits
pip install -r requirements.txt
```

### 2. Configure Environment

```bash
cp .env.example .env
```

Edit `.env` and fill in all values:

```env
# Database
MYSQL_HOST=your-db-host.example.com
MYSQL_USER=your_db_user
MYSQL_PASSWORD=your_db_password
MYSQL_DB=your_database_name
MYSQL_PORT=3306

# DB table and stage filter (customize for your CRM schema)
DB_TABLE=YourSchema.Grant_Opportunities
DB_STAGE_FILTER= Backlog

# API Keys
GEMINI_API_KEY=your_gemini_api_key
SERPAPI_KEY=your_serpapi_key

# Google Sheets
GOOGLE_SHEET_ID=your_google_sheet_id
```

> **Where to get API keys:**
> - Gemini: [Google AI Studio](https://aistudio.google.com/app/apikey)
> - SerpAPI: [serpapi.com](https://serpapi.com/)
> - PS: You can skip SerpAPI, Gemini Search would still function and gove references in the results.(Though SerpAPI is recommended for better grounding)
### 3. Set Up Google Sheets (Service Account)

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a project â†’ Enable **Google Sheets API** and **Google Drive API**
3. Go to **IAM & Admin â†’ Service Accounts** â†’ Create a service account
4. Create and download a JSON key â†’ save it as `credentials.json` in the project root
5. Open your Google Sheet â†’ click **Share** â†’ add the service account email as **Editor**
6. Copy the Sheet ID from the URL into `.env`:
   ```
   https://docs.google.com/spreadsheets/d/<SHEET_ID>/edit
   ```

### 4. Run the Setup Wizard (first time)

```bash
python setup_wizard.py
```

The wizard asks **5 sections** in plain conversational English - no technical knowledge needed:

1. **Your organization** - name, mission, state, target cities
2. **Grant requirements** - focus area, size range, who you serve, equity focus
3. **Red flags** - what should instantly disqualify a grant *(describe naturally - AI structures it)*
4. **Green flags** - what makes a grant a great fit *(describe naturally - AI structures it)*
5. **Classification rules** - what should be RED vs YELLOW vs GREEN for your org, and how many green flags = GREEN

> **You never write R1, R2, G1, G2 etc.** - Gemini converts your plain-English descriptions into structured chain-of-thought flags automatically.

**Example interaction:**
```
â”€â”€ 3 / 5  -  Red Flags â”€â”€
What would immediately rule out a grant for you?
> only funds universities, doesn't fund NJ, arts or environment only, inactive 3+ years

â”€â”€ 4 / 5  -  Green Flags â”€â”€
What makes a grant a great fit?
> STEM or coding focus, has funded Newark or Camden before, targets K-12, equity/low-income

â”€â”€ 5 / 5  -  Classification Rules â”€â”€
What should be YELLOW instead of RED?
> invite-only foundations that still align with our mission - worth reaching out

How many green flags = GREEN? [4]
> 4

Generating your screening configuration with AI...
âœ“ Configuration saved to screener_config.json
```

Everything saved to `screener_config.json` - `main.py` reads it automatically on every run.

---

## Running the Pipeline

```bash
python main.py
```

Output:
```
Initializing Grants Screening Pipeline...
Fetching grants from backlog...
[Sheets] Connected. Results will be written live to Google Sheets.
[Sheets] Skipping 5 already-processed grant(s).

Screening 10 grants...

[1/10] Processing: XYZ Family Foundation...
  [SerpAPI] Searching priority sources...
  [ProPublica] 1 relevant result
  [Granted] 1 relevant result
  [Candid] 1 relevant result
  [CauseIQ] 1 relevant result
  -> GREEN (conf: 0.9)
  -> Written to Sheets âœ“

[2/10] Processing: ABC Family Foundation Inc...
  ...
  -> YELLOW (conf: 1.0)
  -> Written to Sheets âœ“
```

Results appear in your Google Sheet instantly as each grant is processed.

---

## Google Sheet Output

| Column | Description |
|---|---|
| Foundation | Foundation name |
| Classification | GREEN / YELLOW / RED |
| Confidence | 0.0â€“1.0 confidence score |
| Rationale | Plain-English explanation (flags summary removed, just context) |
| Source 1â€“5 | Clickable hyperlinks to research pages |

Rows are color-coded:
- ðŸŸ¢ Light green background â†’ GREEN
- ðŸŸ¡ Light yellow background â†’ YELLOW
- ðŸ”´ Light red background â†’ RED

---

## Updating Your Configuration

### View current config
```bash
python update_config.py --show
```

### Update specific sections
```bash
python update_config.py --org              # Change org name, mission, state, cities
python update_config.py --rules            # Re-generate red/green flags (freeform â†’ AI)
python update_config.py --classification   # Update RED/YELLOW/GREEN decision rules
python update_config.py --size             # Change min/max grant size
python update_config.py --threshold        # Change how many green flags = GREEN (default: 4)
python update_config.py --full             # Re-run the entire setup wizard
```

### Example: updating rules
```bash
python update_config.py --rules

â”€â”€ Update Screening Rules â”€â”€
What should DISQUALIFY a grant?
> only funds higher education, outside northeast, arts/environment only

What should make a grant a GREAT FIT?
> STEM or technology focus, targets youth 12-18, equity/low-income focus, NJ or NYC based

AI updating your rules...
Config saved to screener_config.json
```

---

## Utility Scripts

### Check how many grants are in your backlog
```bash
python count_backlog.py
```
Output:
```
Total rows in Grant_Opportunities: 269

Stage breakdown:
  Backlog                              46  <-- backlog
  Closed Won                               134
  ...
```

### Clear the Google Sheet
```bash
python clear_sheet.py
```
Wipes all rows **and** background colors. The header will be re-written on the next `main.py` run.

### Fix column layout (after schema changes)
```bash
python fix_columns.py
```
One-time utility if you change the column structure and existing rows are misaligned.

---

## Configuration Files

| File | Description | In Git? |
|---|---|---|
| `.env` | API keys, DB credentials | âŒ Excluded |
| `credentials.json` | Google service account key | âŒ Excluded |
| `screener_config.json` | Your screening rules (generated by wizard) | âŒ Excluded |
| `.env.example` | Template with all required keys | âœ… Included |

---

## How the AI Makes Decisions

The pipeline uses **meta-prompting**: the setup wizard uses Gemini to *build the prompt* that Gemini will later use for screening. This means:

1. You describe your needs in plain English
2. Gemini converts your description into structured chain of thinking prompt(defines R-flags and G-flags)
3. For each grant, Gemini walks through every flag explicitly before classifying
4. `temperature=0` ensures consistent, deterministic results across runs

The rationale in the sheet shows the exact green flag count (e.g., `"Green flags: 5/8 (G1âœ“ G3âœ“ G5âœ“ G6âœ“ G8âœ“)"`), so you can always see exactly why a grant was classified the way it was.

---

## Roadmap / Possible Extensions

- [ ] Email digest of new GREEN grants
- [ ] Slack/Teams notification on new GREEN
- [ ] Web UI for setup wizard (instead of CLI)
- [ ] Support for Airtable / Google Sheets as data source (instead of MySQL)
- [ ] Scheduled weekly runs via cron / GitHub Actions

---

